<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Why leaving the hospital early can be deadly for children – Why Leaving the Hospital Early Can Be Deadly for Children</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Why Leaving the Hospital Early Can Be Deadly for Children</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-why-leaving-the-hospital-early-matters" id="toc-introduction-why-leaving-the-hospital-early-matters" class="nav-link active" data-scroll-target="#introduction-why-leaving-the-hospital-early-matters">Introduction: Why Leaving the Hospital Early Matters</a></li>
  <li><a href="#what-is-an-unplanned-discharge" id="toc-what-is-an-unplanned-discharge" class="nav-link" data-scroll-target="#what-is-an-unplanned-discharge">What Is an Unplanned Discharge?</a></li>
  <li><a href="#using-data-to-study-child-outcomes" id="toc-using-data-to-study-child-outcomes" class="nav-link" data-scroll-target="#using-data-to-study-child-outcomes">Using Data to Study Child Outcomes</a></li>
  <li><a href="#a-case-study-from-uganda" id="toc-a-case-study-from-uganda" class="nav-link" data-scroll-target="#a-case-study-from-uganda">A Case Study from Uganda</a></li>
  <li><a href="#what-the-data-revealed" id="toc-what-the-data-revealed" class="nav-link" data-scroll-target="#what-the-data-revealed">What the Data Revealed</a></li>
  <li><a href="#why-these-findings-matter" id="toc-why-these-findings-matter" class="nav-link" data-scroll-target="#why-these-findings-matter">Why These Findings Matter</a></li>
  <li><a href="#limitations-and-challenges" id="toc-limitations-and-challenges" class="nav-link" data-scroll-target="#limitations-and-challenges">Limitations and Challenges</a></li>
  <li><a href="#conclusion-how-data-science-can-save-lives" id="toc-conclusion-how-data-science-can-save-lives" class="nav-link" data-scroll-target="#conclusion-how-data-science-can-save-lives">Conclusion: How Data Science Can Save Lives</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Why leaving the hospital early can be deadly for children</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-why-leaving-the-hospital-early-matters" class="level2">
<h2 class="anchored" data-anchor-id="introduction-why-leaving-the-hospital-early-matters">Introduction: Why Leaving the Hospital Early Matters</h2>
<p>When a child is sick enough to be hospitalized, many people assume the biggest danger is during the hospital stay. But in many low-resource settings, a large number of child deaths happen after families go home. This is called <strong>post-discharge mortality</strong> and it can be just as serious as what happens inside the hospital.</p>
<p>One factor that can make outcomes worse is <strong>unplanned discharge</strong>, sometimes called “Discharge Against Medical Advice or DAMA” This happens when a caregiver takes a child out of the hospital before the medical team has decided the child is ready to leave. The decision is often shaped by real-life pressures: money for food or transport, responsibilities at home, frustration with long waits, or the belief that the child is already improving.</p>
<p>In this post, I use a real cohort study from six hospitals in Uganda to explain why unplanned discharges matter, what the data shows about mortality and readmissions, and how data science can help identify which children are most at risk. The key message is simple: leaving early is rarely a single “bad choice” it is often a sign of deeper clinical and social vulnerability that health systems need to address.</p>
</section>
<section id="what-is-an-unplanned-discharge" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-unplanned-discharge">What Is an Unplanned Discharge?</h2>
<p>An <strong>unplanned discharge</strong> means a child leaves the hospital without the discharge being initiated by the medical team. In other words, the caregiver decides to leave before the healthcare provider thinks it is safe or appropriate. In the literature, this is sometimes labeled “discharge against medical advice (DAMA),” but that wording can be misleading. In many cases, families leave because they do not feel they have a realistic option to stay.</p>
<p>There are several common reasons. Some are <strong>financial</strong>, such as the cost of meals, medicines, transportation, or staying near the hospital. Others are <strong>social</strong>, like needing to care for other children at home or needing to return to work. Some reasons are related to the <strong>health system</strong>, such as long wait times, poor communication, or dissatisfaction with care. Finally, some caregivers may think the child is improving and believe continued hospitalization is unnecessary.</p>
<p>From a data science perspective, the important point is that unplanned discharge is not random. It tends to happen more often in children who are already medically high-risk (for example, malnutrition or HIV) and families facing difficult living conditions. That combination can create a dangerous situation after discharge, especially when follow-up care is hard to access.</p>
</section>
<section id="using-data-to-study-child-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="using-data-to-study-child-outcomes">Using Data to Study Child Outcomes</h2>
<p>To make this concrete, I will refer to a multisite cohort study conducted across six Ugandan hospitals. The study followed children aged 0–60 months who were admitted with suspected or proven infections and tracked outcomes for six months after discharge. It found that unplanned discharges were common and were strongly linked to higher mortality and readmission after leaving the hospital.</p>
</section>
<section id="a-case-study-from-uganda" class="level2">
<h2 class="anchored" data-anchor-id="a-case-study-from-uganda">A Case Study from Uganda</h2>
<p>To better understand the consequences of unplanned discharge, this blog draws on a multisite cohort study conducted across six hospitals in Uganda. The study included 6,189 children between the ages of 0 and 60 months who were admitted with suspected or confirmed infections. These children were followed for six months after leaving the hospital to assess outcomes such as mortality and hospital readmission.</p>
<p>Among all discharged children, approximately 13% experienced an unplanned discharge. This means that more than one in ten children left the hospital before their care team considered them medically ready. Importantly, the study did not end at discharge. Researchers conducted follow-up phone calls and in-person visits to determine whether children survived, were readmitted to hospital, or died at home.</p>
<p>This type of cohort study is particularly valuable because it captures outcomes that are often missed in routine hospital data. In many low-resource settings, deaths that occur at home after discharge are not systematically recorded. By actively following families over time, the study provides a more complete picture of what happens to children after they leave the hospital and allows researchers to link discharge decisions to longer-term outcomes.</p>
</section>
<section id="what-the-data-revealed" class="level2">
<h2 class="anchored" data-anchor-id="what-the-data-revealed">What the Data Revealed</h2>
<p>The results of the study showed a clear and concerning pattern. Children who experienced an unplanned discharge were significantly more likely to die or be readmitted to hospital within six months compared to those who were discharged as planned. Specifically, unplanned discharge was associated with more than double the risk of post-discharge mortality and readmission.</p>
<p>Several important risk factors were also identified. Children with severe malnutrition, HIV infection, or anemia were more likely to experience an unplanned discharge. Social factors played a major role as well. Lower maternal education, limited access to clean drinking water, and greater distance from the hospital were all associated with higher rates of unplanned discharge.</p>
<p>One particularly striking finding was where deaths occurred. Children who left the hospital through unplanned discharge were more likely to die at home rather than during a hospital readmission. This suggests that many of these children became severely ill again without accessing healthcare in time. Together, these findings highlight how clinical vulnerability and social disadvantage can combine to produce especially high-risk outcomes after discharge.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/uganda.png" class="img-fluid figure-img"></p>
<figcaption>Mortality and readmission rates among children with planned versus unplanned discharge</figcaption>
</figure>
</div>
<p>The figure above shows the difference in post-discharge outcomes between children who experienced planned and unplanned discharge. Children with unplanned discharge had substantially higher rates of mortality and hospital readmission within six months of discharge.</p>
</section>
<section id="why-these-findings-matter" class="level2">
<h2 class="anchored" data-anchor-id="why-these-findings-matter">Why These Findings Matter</h2>
<p>These findings have important implications for both healthcare systems and policy. First, they show that unplanned discharge is not simply an isolated decision made by individual families. Instead, it reflects deeper structural challenges, including poverty, limited access to resources, and gaps in communication between healthcare providers and caregivers.</p>
<p>From a data science perspective, this study demonstrates how combining clinical data with social and follow-up information can reveal patterns that would otherwise remain hidden. Without post-discharge follow-up, the true impact of unplanned discharge on child mortality would be underestimated. Data-driven insights like these can help healthcare systems identify children at highest risk and design targeted interventions, such as enhanced discharge counseling, social support, or early follow-up visits.</p>
<p>More broadly, the findings emphasize that improving child survival requires looking beyond hospital walls. Even high-quality inpatient care may fail to protect vulnerable children if social and economic barriers force families to leave early or prevent them from seeking care after discharge.</p>
</section>
<section id="limitations-and-challenges" class="level2">
<h2 class="anchored" data-anchor-id="limitations-and-challenges">Limitations and Challenges</h2>
<p>While the study provides valuable insights, it also has important limitations. One key limitation is that the specific reasons why caregivers chose to leave the hospital early were not directly recorded. As a result, researchers had to infer motivations based on clinical and socio-demographic data rather than firsthand accounts.</p>
<p>In addition, although the study included multiple hospitals, all were located in semi-urban areas. This means the findings may not fully represent experiences in highly rural or densely urban settings. There may also be other unmeasured social factors, such as family dynamics or cultural beliefs, that influence discharge decisions but were not captured in the dataset.</p>
<p>These limitations highlight a common challenge in data science and public health research: even large and well-designed datasets cannot capture every aspect of human decision-making. Recognizing these gaps is essential for interpreting results responsibly and for guiding future research that combines quantitative data with qualitative approaches.</p>
</section>
<section id="conclusion-how-data-science-can-save-lives" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-how-data-science-can-save-lives">Conclusion: How Data Science Can Save Lives</h2>
<p>Unplanned discharge is a powerful indicator of vulnerability in pediatric healthcare. The evidence from Uganda shows that children who leave the hospital early face a much higher risk of death and readmission, often in settings where timely care is difficult to access. These outcomes are shaped not only by medical conditions, but also by social and economic pressures faced by families.</p>
<p>Data science plays a crucial role in uncovering these patterns. By linking hospital records with post-discharge follow-up and social data, researchers can move beyond assumptions and identify which children are most at risk. This knowledge can inform targeted interventions that support families during hospitalization and after discharge.</p>
<p>Ultimately, reducing child mortality requires more than effective treatment inside hospitals. It requires data-informed strategies that recognize the realities families face and ensure that vulnerable children receive the care they need, both during admission and long after they return home.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>